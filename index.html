<!-- save as sign-and-publish.html and host on GitHub Pages or any static host -->
<!doctype html>
<html lang="fa">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ØªÙˆÙ„ÛŒØ¯ Ø§Ù…Ø¶Ø§ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ GitHub</title>
<style>
  :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{max-width:900px;margin:28px auto;padding:18px;background:#f7f7fb;border-radius:12px;color:#111}
  h1{font-size:20px;margin-bottom:6px}
  .card{background:white;padding:14px;border-radius:10px;box-shadow:0 6px 20px rgba(20,20,50,0.06);margin-bottom:12px}
  label{display:block;margin-top:8px;font-weight:600}
  textarea, input[type=text], input[type=password]{width:100%;padding:8px;margin-top:6px;border:1px solid #e2e6ef;border-radius:8px;font-size:14px}
  button{margin-top:10px;padding:10px 14px;border-radius:8px;border:0;background:#2b6df6;color:white;font-weight:600;cursor:pointer}
  small{color:#555}
  pre{white-space:pre-wrap;background:#f3f6ff;padding:10px;border-radius:8px;overflow:auto}
  .row{display:flex;gap:8px}
  .col{flex:1}
  .muted{color:#666;font-size:13px}
</style>
</head>
<body>
  <div class="card">
    <h1>ØªÙˆÙ„ÛŒØ¯ Ø§Ù…Ø¶Ø§ (Ed25519) Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ GitHub</h1>
    <p class="muted">Ú©Ù„ÛŒØ¯ Ø®ØµÙˆØµÛŒ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù‡ÛŒÚ†â€ŒÙˆÙ‚Øª Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø§Ø±Ø³Ø§Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ù…Ú¯Ø± Ø®ÙˆØ¯ØªØ§Ù† ØµØ±ÛŒØ­Ø§Ù‹ Ø¨Ø®ÙˆØ§Ù‡ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ´Ø§Ø± Ø±ÙˆÛŒ GitHub Ø§Ø² Gist ÛŒØ§ api Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ (ØªÙˆÚ©Ù† Ù„Ø§Ø²Ù… Ø§Ø³Øª).</p>
  </div>

  <div class="card">
    <label>Ù¾ÛŒØºØ§Ù… / ÙØ§ÛŒÙ„ (Ù…ØªÙ†) Ø¨Ø±Ø§ÛŒ Ø§Ù…Ø¶Ø§</label>
    <textarea id="message" rows="4">Ø§ÛŒÙ† ÛŒÚ© Ù¾ÛŒØ§Ù… ØªØ³Øª Ø§Ø³Øª â€” Ø§Ù…Ø¶Ø§ ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ø³Ø§ÛŒØª.</textarea>

    <div class="row" style="margin-top:10px">
      <div class="col">
        <button id="gen">ØªÙˆÙ„ÛŒØ¯ Ú©Ù„ÛŒØ¯ Ø¬Ø¯ÛŒØ¯</button>
      </div>
      <div class="col">
        <button id="sign" disabled>Ø§Ù…Ø¶Ø§ Ú©Ù†</button>
      </div>
    </div>

    <div style="margin-top:12px">
      <label>Ú©Ù„ÛŒØ¯ Ø¹Ù…ÙˆÙ…ÛŒ (Base64)</label>
      <pre id="pub" aria-live="polite">â€”</pre>

      <label>Ú©Ù„ÛŒØ¯ Ø®ØµÙˆØµÛŒ (Base64) â€” ÙÙ‚Ø· Ø§Ú¯Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒ</label>
      <pre id="priv" aria-live="polite">â€”</pre>

      <label>Ø§Ù…Ø¶Ø§ (Base64)</label>
      <pre id="sig" aria-live="polite">â€”</pre>
    </div>
  </div>

  <div class="card">
    <h3>Ø§Ù†ØªØ´Ø§Ø± Ø±ÙˆÛŒ GitHub</h3>
    <p class="muted">Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ´Ø§Ø± Ø¨Ø§ÛŒØ¯ ØªÙˆÚ©Ù† GitHub (Ø¨Ø§ scope: gist ÛŒØ§ repo) Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø¯Ø³ØªÛŒ ÙˆØ§Ø±Ø¯ Ø´ÙˆØ¯. Ø´Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ OAuth2 Ù¾ÛŒØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ ØªØ§ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø¯ÙˆÙ† ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† ØªÙˆÚ©Ù† Ø¹Ù…Ù„ Ú©Ù†Ø¯.</p>

    <label>ØªÙˆÚ©Ù† Ø´Ø®ØµÛŒ GitHub (ÛŒØ§ Ø®Ø§Ù„ÛŒ Ø¨Ú¯Ø°Ø§Ø± Ø¨Ø±Ø§ÛŒ ÙÙ‚Ø· Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø­Ù„ÛŒ)</label>
    <input id="token" type="password" placeholder="ghp_..." />

    <div class="row">
      <div class="col">
        <button id="publish-gist" disabled>Ø§ÛŒØ¬Ø§Ø¯ Gist Ø¨Ø§ Ú©Ù„ÛŒØ¯ Ø¹Ù…ÙˆÙ…ÛŒ Ùˆ Ø§Ù…Ø¶Ø§</button>
      </div>
      <div class="col">
        <button id="download-zip" disabled>Ø¯Ø§Ù†Ù„ÙˆØ¯ ZIP Ø§Ø² Ú©Ù„ÛŒØ¯ Ùˆ Ø§Ù…Ø¶Ø§</button>
      </div>
    </div>

    <div id="status" style="margin-top:10px" class="muted"></div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/tweetnacl@1.0.3/nacl.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tweetnacl-util@0.15.1/nacl-util.min.js"></script>
<script>
  // Helper utilities
  const u8ToB64 = (u8) => btoa(String.fromCharCode(...u8));
  const b64ToU8 = (b64) => new Uint8Array(atob(b64).split('').map(c=>c.charCodeAt(0)));
  const u8ToHex = (u8) => Array.from(u8).map(b=>b.toString(16).padStart(2,'0')).join('');

  let keyPair = null;
  const el = {
    gen: document.getElementById('gen'),
    sign: document.getElementById('sign'),
    message: document.getElementById('message'),
    pub: document.getElementById('pub'),
    priv: document.getElementById('priv'),
    sig: document.getElementById('sig'),
    token: document.getElementById('token'),
    publishGist: document.getElementById('publish-gist'),
    downloadZip: document.getElementById('download-zip'),
    status: document.getElementById('status')
  };

  el.gen.addEventListener('click', ()=>{
    // Generate Ed25519 keypair (tweetnacl uses nacl.sign.keyPair())
    keyPair = nacl.sign.keyPair();
    const pubB64 = u8ToB64(keyPair.publicKey);
    const privB64 = u8ToB64(keyPair.secretKey.slice(0,32)); // first 32 bytes is private seed
    el.pub.textContent = pubB64;
    el.priv.textContent = privB64 + "\\n\\nğŸ” (Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ø§Ù…Ù† ÙØ±Ø§Ù…ÙˆØ´ Ù†Ø´ÙˆØ¯)";
    el.sign.disabled = false;
    el.publishGist.disabled = true;
    el.downloadZip.disabled = true;
    el.sig.textContent = "â€”";
    el.status.textContent = "Ú©Ù„ÛŒØ¯ Ø¬Ø¯ÛŒØ¯ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯. Ø­Ø§Ù„Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù¾ÛŒØ§Ù… Ø±Ø§ Ø§Ù…Ø¶Ø§ Ú©Ù†ÛŒØ¯.";
  });

  el.sign.addEventListener('click', ()=>{
    if(!keyPair){ alert('Ø§Ø¨ØªØ¯Ø§ Ú©Ù„ÛŒØ¯ Ø¨Ø³Ø§Ø²ÛŒØ¯.'); return; }
    const msgStr = el.message.value || "";
    const msgU8 = nacl.util.decodeUTF8(msgStr);
    const signed = nacl.sign(msgU8, keyPair.secretKey);
    const signature = signed.slice(0,64); // 64-byte signature
    const sigB64 = u8ToB64(signature);
    el.sig.textContent = sigB64;
    el.publishGist.disabled = false;
    el.downloadZip.disabled = false;
    el.status.textContent = "Ù¾ÛŒØºØ§Ù… Ø§Ù…Ø¶Ø§ Ø´Ø¯. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù† Ø±Ø§ Ù…Ù†ØªØ´Ø± ÛŒØ§ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯.";
  });

  // Create a gist with public key + signature + message
  el.publishGist.addEventListener('click', async ()=>{
    const token = el.token.value.trim();
    if(!token){ if(!confirm("Ø´Ù…Ø§ ØªÙˆÚ©Ù† GitHub ÙˆØ§Ø±Ø¯ Ù†Ú©Ø±Ø¯ÛŒØ¯. Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Gist Ø±Ø§ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ù†Ø§Ø´Ù†Ø§Ø³ (ØºÛŒØ±Ù…Ù…Ú©Ù†) Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯ØŸ (Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Gist Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙˆÚ©Ù† Ø¯Ø§Ø±ÛŒØ¯)")) return; }
    if(!keyPair || el.sig.textContent==="â€”"){ alert('Ø§Ø¨ØªØ¯Ø§ Ù¾ÛŒØ§Ù… Ø±Ø§ Ø§Ù…Ø¶Ø§ Ú©Ù†ÛŒØ¯.'); return; }

    el.status.textContent = "Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ GitHub...";
    const body = {
      description: "Public key + signature generated on-site",
      public: true,
      files: {
        "public_key.b64": { content: el.pub.textContent },
        "signature.b64": { content: el.sig.textContent },
        "message.txt": { content: el.message.value }
      }
    };

    try{
      const resp = await fetch("https://api.github.com/gists", {
        method: "POST",
        headers: {
          "Content-Type":"application/json",
          "Authorization": token ? ("token " + token) : undefined
        },
        body: JSON.stringify(body)
      });
      const data = await resp.json();
      if(resp.ok){
        el.status.innerHTML = "Gist Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯: <a href='"+data.html_url+"' target=_blank>"+data.html_url+"</a>";
      } else {
        el.status.textContent = "Ø®Ø·Ø§ Ù‡Ù†Ú¯Ø§Ù… Ø³Ø§Ø®Øª Gist: " + (data.message || resp.status);
      }
    }catch(err){
      el.status.textContent = "Ø®Ø·Ø§ Ø´Ø¨Ú©Ù‡: " + err;
    }
  });

  // Download ZIP (simple: create files and zip using JSZip or offer separate downloads)
  el.downloadZip.addEventListener('click', async ()=>{
    if(!keyPair || el.sig.textContent==="â€”"){ alert('Ø§Ø¨ØªØ¯Ø§ Ù¾ÛŒØ§Ù… Ø±Ø§ Ø§Ù…Ø¶Ø§ Ú©Ù†ÛŒØ¯.'); return; }
    // Create a small zip using plain blobs (no external lib) => create a multi-file .zip is complex,
    // here we'll just create a single .tar-like blob as .zip may be heavy. Simpler: offer individual downloads.
    function dl(filename, text){
      const a = document.createElement('a');
      a.href = URL.createObjectURL(new Blob([text], {type:'text/plain'}));
      a.download = filename;
      a.click();
    }
    dl("public_key.b64.txt", el.pub.textContent);
    dl("private_key.b64.txt", el.priv.textContent.split("\\n")[0]);
    dl("signature.b64.txt", el.sig.textContent);
    dl("message.txt", el.message.value);
    el.status.textContent = "ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯Ù†Ø¯ (Ú†Ù‡Ø§Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡).";
  });

  // UX: enable publish only after signature
  el.token.addEventListener('input', ()=>{ /* optional: nothing */ });

</script>
</body>
</html>
